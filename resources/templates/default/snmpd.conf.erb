<%# Copyright 2010, Eric G. Wolfe %>
<%# Modified by Pablo Nebrera to adapt it to redBorder IPS %>
<%# License: Apache 2.0 %>
###############################################################################
# Generated by Chef for <%= @hostname %>
###############################################################################

com2sec local          127.0.0.1/32    private
com2sec notConfigUser  default         <%= @community %> 

group MyRWGroup v1  local
group MyRWGroup v2c local
group MyRWGroup usm local

group MyROGroup v1  notConfigUser
group MyROGroup v2c notConfigUser
group MyROGroup usm notConfigUser

view    all           included   .1                    80
view    systemview    included   .1.3.6.1.2.1.1
view    systemview    included   .1.3.6.1.2.1.25.1.1

access  MyROGroup      ""      any       noauth    exact    all    none   none
access  MyRWGroup      ""      any       noauth    exact    all    all   all

syslocation <%= @cdomain %>
syscontact  <%= @hostname %> <<%= "#{@hostname}@#{@cdomain}" %>>

includeAllDisks 10%

master agentx
agentSecName <%= @snmp_username %>
createUser <%= @snmp_username %> MD5 <%= @snmp_pass %>
rouser <%= @snmp_username %> auth
iquerySecName <%= @snmp_username %>

trapcommunity <%= @community %>
trap2sink 127.0.0.1 


# Monitoring
monitor DiskAlmostFull dskPercent > 90
monitor machineTooBusy hrProcessorLoad > 90

<%  counter=1 %>
proc chef-client
proc sshd
monitor chef-client-stopped -r 10 -I .1.3.6.1.4.1.2021.2.1.5.<%= counter %> == 0
monitor chef-client-started -r 10 -I .1.3.6.1.4.1.2021.2.1.5.<%= counter %> > 0
<% counter+=1 %>
monitor sshd-stopped -r 10 -I .1.3.6.1.4.1.2021.2.1.5.<%= counter %> == 0
monitor sshd-started -r 10 -I .1.3.6.1.4.1.2021.2.1.5.<%= counter %> > 0
<% counter+=1 %>
monitor postfix-stopped -r 10 -I .1.3.6.1.4.1.2021.2.1.5.<%= counter %> == 0
monitor postfix-started -r 10 -I .1.3.6.1.4.1.2021.2.1.5.<%= counter %> > 0

disk /
